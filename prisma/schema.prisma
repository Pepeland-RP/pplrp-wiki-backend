generator db {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

/**
 * # Про ID ресурса
 * Планируется реализовать общее хранилище всех ресурсов, включая изображения, модели и тд
 * Каждый файл будет иметь имя в формате UUIDv4, а доступ к ним будет осуществляться через отдельный эндпоинт
 */

// costumes db test
model Costume {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now())

  Season   Season? @relation(fields: [seasonId], references: [id])
  seasonId Int?

  MinecraftItem MinecraftItem[]
  Category      Category[]

  Gltf   Gltf?
  GltfId Int?  @unique
}

// Таблица сезонов
// Реляция с моделями many-to-many
model Season {
  id   Int     @id @default(autoincrement())
  name String
  icon String? // ID/имя иконки; мб потом поменяем

  priority Int @default(0) // Сортировка на основе сезона. Больше значение - больше приоритет (не используется)

  Costumes   Costume[]
  created_at DateTime  @default(now())
}

// Таблица с Minecraft предметами, на которые можно применить модель
// Реляция с моделями many-to-many
model MinecraftItem {
  id          Int       @id @default(autoincrement())
  name        String
  str_id      String
  resource_id String // ID текстуры в хранилище
  Costumes    Costume[]

  created_at DateTime @default(now())
}

// Таблица с категориями для моделей
model Category {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  Costumes Costume[]

  created_at DateTime @default(now())
}

model Gltf {
  id          Int      @id @default(autoincrement())
  resource_id String // ID текстуры в хранилище
  meta        Json? // Возможная мета для отображения (например размер, поворот и тд)
  Costume     Costume? @relation(fields: [CostumeId], references: [id])
  CostumeId   Int?     @unique

  created_at DateTime @default(now())
}

model User {
  id          Int          @id @default(autoincrement())
  login       String       @unique
  password    String
  permissions Permission[]
}

model Permission {
  id            Int    @id @default(autoincrement())
  permission_id Int
  name          String @default("")
  users         User[]
}
